<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arb Local - Arbitrage Finder</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 16px; }
        th, td { border: 1px solid #ddd; padding: 8px 12px; text-align: left; }
        th { background: #333; color: white; }
        tr.arb { background: #d4edda !important; }
        button { padding: 8px 16px; cursor: pointer; margin-top: 8px; }
    </style>
</head>
<body>
    <h1>Arbitrage Finder</h1>
    <p>Sample betting events. Rows with ⭐ have arbitrage.</p>
    <table id="events-table">
        <thead>
            <tr>
                <th>Sport</th>
                <th>Event</th>
                <th>Market</th>
                <th>Best Odds</th>
                <th></th>
                <th>Profit %</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <script>
        let events = [];
        let arbs = [];

        async function load() {
            const [eventsRes, arbsRes] = await Promise.all([
                fetch('/events'),
                fetch('/arbitrage')
            ]);
            events = await eventsRes.json();
            arbs = await arbsRes.json();
            render();
        }

        function getArb(eventId) {
            return arbs.find(a => a.event_id === eventId);
        }

        function render() {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';
            for (const e of events) {
                const arb = getArb(e.id);
                const isArb = !!arb;
                const bestOdds = arb
                    ? `${arb.best_odds.team1.team} @ ${arb.best_odds.team1.odds} (${arb.best_odds.team1.book}) / ${arb.best_odds.team2.team} @ ${arb.best_odds.team2.odds} (${arb.best_odds.team2.book})`
                    : '-';
                const profit = arb ? arb.profit_percent + '%' : '-';
                const star = isArb ? '⭐' : '';
                const row = document.createElement('tr');
                if (isArb) row.classList.add('arb');
                row.innerHTML = `
                    <td>${e.sport}</td>
                    <td>${e.event}</td>
                    <td>${e.market}</td>
                    <td>${bestOdds}</td>
                    <td>${star}</td>
                    <td>${profit}</td>
                    <td>
                        ${isArb ? `<button data-odds1="${arb.best_odds.team1.odds}" data-odds2="${arb.best_odds.team2.odds}">Calculate Stakes</button>` : '-'}
                    </td>
                `;
                const btn = row.querySelector('button');
                if (btn) btn.onclick = () => handleCalculate(btn.dataset.odds1, btn.dataset.odds2);
                tbody.appendChild(row);
            }
        }

        load();
    </script>
</body>
</html>
